# [Performances list](https://developer.yahoo.com/performance/rules.html#flush)

    YAHOO将Rules分成Content, Server, Cookie, CSS, JavaScript, Images, Mobile七类
    
    另一个角度来看,网页的展现有loading阶段和render阶段,render阶段还是js,css,html三类前端技术,而在loading阶段我们则需要关注http:减少http数,优化单个http的各个时间段,减少收发数据量,有效利用缓存等等

## 1.Content 网页内容

- 减少http请求次数

    1. 捆绑文件
    2. CSS Sprites
    3. Image Maps: http://en.wikipedia.org/wiki/Image_map
    4. Inline images: 将图片通过编码的字符串内嵌到网页文本中

- 减少DNS查询次数
- 避免页面跳转
- 缓存Ajax
- 延迟加载: 网页最初加载需要的最小内容集
- 提前加载: 

    1. 无条件提前加载：当前网页加载完成后，马上去下载一些其他的内容
    2. 有条件加载：根据用户的输入推断需要加载的内容
    3. 有预期的的加载: 网页重新设计时，由于用户经常访问旧网页，本地对旧的网页内容缓存充分从而显得旧网页速度很快，而新的网页内容却没有缓存，设计者可以在旧网页的内容中预先加载一些新网页中可能用到的内容

- 减少DOM元素数量
- 根据域名划分内容

    浏览器一般对同一个域的下载连接数有所限制，按照域名划分下载内容可以浏览器增大并行下载连接，但是注意控制域名使用在2-4个之间，不然dns查询也是个问题

- 减少iframe数量

    优点

        可以用来加载速度较慢的内容，例如广告。
        安全沙箱保护。浏览器会对iframe中的内容进行安全控制。
        脚本可以并行下载

    缺点

        即使iframe内容为空也消耗加载时间
        会阻止页面加载
        没有语义

- 避免404

## 2.Server 服务器

- 使用CDN, CDN 节点可以解决跨运营商和跨地域访问的问题,无 cookie 传输,分散源服务器的压力

    减少网页内容的下载时间。提高下载速度还可以通过CDN(内容分发网络)来提升。CDN通过部署在不同地区的服务器来提高客户的下载速度。

    CDN 是如何分散源服务器的压力的？

    CDN 的核心点有两个: 一个是缓存，一个是回源。

    通过缓存和回源策略，达到分散源服务器的压力。首先将从根服务器请求来的资源按要求缓存。然后当有用户访问某个资源的时候，如果被解析到的那个 CDN 节点没有缓存响应的内容，或者是缓存已经到期，就会回源站去获取。

- 添加Expires 或Cache-Control报文头

    对于静态内容添加Expires，将静态内容设为永不过期
    对于动态内容应用合适的Cache-Control，让浏览器根据条件来发送请求。

- Gzip压缩传输文件
- 配置ETags

    通过一个文件版本标识使得服务器可以轻松判断该请求的内容是否有所更新，如果没有就回复304 (not modified)，从而避免下载整个文件

    Etags的版本信息即使主流服务器未能很好地支持跨服务器的判断，比如你从一个服务器集群中一台得到Etags，然后发送到了另一台那么校验很有可能会失败。

- 尽早flush输出
- 使用GET Ajax请求

    浏览器在实现XMLHttpRequest POST的时候分成两步，先发header，然后发送数据。

- 避免空的图片src

## 3.Cookie

- 减少Cookie大小

    去除没有必要的cookie，如果网页不需要cookie就完全禁掉
    将cookie的大小减到最小
    注意cookie设置的domain级别，没有必要情况下不要影响到sub-domain
    设置合适的过期时间，比较长的过期时间可以提高响应速度。

- 页面内容使用无cookie域名

    静态资源都没必要cookie，我们可以采用不同的domain来单独存放这些静态文件，这样做不仅可以减少cookie大小从而提高响应速度，还有一个好处是有些proxy拒绝缓存带有cookie的内容，如果能将这些静态资源cookie去除，那就可以得到这些proxy的缓存支持。

## 4.CSS

- 将样式表置顶
- 避免CSS表达式
- 用link代替@import

    @import的原因很简单，因为它相当于将css放在网页内容底部

- 避免使用Filters

## 5.Javascript

- 将脚本置底
- 使用外部Javascirpt和CSS文件
- 精简Javascript和CSS
- 去除重复脚本
- 减少DOM访问

    缓存已经访问过的元素
    Offline更新节点然后再加回DOM Tree
    避免通过Javascript修复layout

- 使用智能事件处理, 事件委托

## 6.图像

- 优化图像, webp
- 优化CSS Sprite

    Spirite中水平排列图片，垂直排列会增加文件大小；
    Spirite中把颜色较近的组合在一起可以降低颜色数，理想状况是低于256色以便适用PNG8格式；
    不要在Spirite的图像中间留有较大空隙。这虽然不大会增加文件大小,但对于用户代理来说它需要更少的内存来把图片解压为像素地图。100×100的图片为1万像素，1000×1000就是100万像素。

- 使用小且可缓存的favicon.ico
- 不要在HTML中缩放图片
- 图片懒加载

## 7.移动客户端

- 保持单个内容小于25KB

    这限制是因为iphone，他只能缓存小于25K

- 打包组建成符合文档

## other

- bigpipe 客户端服务器端同时渲染，

- 无阻脚本下载,在ondomready之前只在头部输出一个很小的外部脚本,作为bigpipe的支撑.其余所有模块如果依赖外部脚本(比如某一模块需要日历控件支持),都会在domready事件之后加载.这样做即保证了所有页面所有模块都能在domready前快速形成展现,又可以保证无脚本阻滞的快速的domready时间.

- 最快可交互时间:在domready后所依赖脚本已被加载之前,点击行为将会生成一个额外的脚本请求,只将这个点击所依赖的脚步预先load进来.这样保证了最快的可交互时间.

- 使用 Http2.0 多路复用解决了多域名并发现在问题，可以节省资源总体的下载时间，还有请求头压缩和差异传输也会提高传输效率。1. 多路复用; 2.二进制分帧
